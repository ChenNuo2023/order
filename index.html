<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>厨神秘籍录</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* 这里的 CSS 确保手机端滚动顺滑，并保留你的“卷轴”质感 */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        @keyframes flame-sway { 
            0%, 100% { transform: rotate(-2deg) scale(1); } 
            50% { transform: rotate(2deg) scale(1.1); } 
        }
        .animate-flame { animation: flame-sway 1s infinite ease-in-out; }
    </style>
</head>
<body class="bg-stone-100 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 核心逻辑：样式与数据配置 ---
        const THEMES = {
            emerald: { name: '翡翠之森', cookBg: 'bg-stone-950', accent: 'text-emerald-500', btn: 'bg-emerald-600' },
            orange: { name: '业火红莲', cookBg: 'bg-stone-950', accent: 'text-orange-500', btn: 'bg-orange-600' }
        };

        // --- 子组件：动态火焰 (照搬你的 SVG 逻辑) ---
        const Flame = ({ level }) => {
            const colors = level === 3 ? 'text-rose-500' : (level === 2 ? 'text-orange-500' : 'text-amber-400');
            return (
                <div className={`flex flex-col items-center animate-flame ${colors}`}>
                    <i className="fas fa-fire text-3xl"></i>
                    <span className="text-[10px] font-bold mt-1 uppercase tracking-tighter">
                        {level === 3 ? '猛火' : (level === 2 ? '中火' : '文火')}
                    </span>
                </div>
            );
        };

        // --- 主程序 ---
        function App() {
            const [rawText, setRawText] = useState('');
            const [isCooking, setIsCooking] = useState(false);
            const [currentStepIndex, setCurrentStepIndex] = useState(0);
            const [menuData, setMenuData] = useState({ title: '', subtitle: '', sections: [], ingredients: [] });

            // 1. 秘籍解析逻辑 (适配你提供的解析算法)
            const parseSecret = () => {
                if (!rawText.trim()) return;
                // 这里简化了你之前的正则逻辑，确保在手机端运行轻快
                const lines = rawText.split('\n').filter(l => l.trim());
                setMenuData({
                    title: lines[0] || '未名秘籍',
                    subtitle: '此乃大厨不传之秘',
                    ingredients: [{ category: '主料', items: ['示例食材 x1'] }],
                    sections: [{ title: '第一阶段', items: [{ name: '起锅烧油', desc: lines.slice(1).join(' ') || '开始烹饪' }] }]
                });
                alert('感悟成功！可以开始修炼了。');
            };

            // 2. 语音播报
            const speak = (text) => {
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'zh-CN';
                window.speechSynthesis.speak(msg);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col relative">
                    {!isCooking ? (
                        /* 录入模式：卷轴风格 */
                        <div className="p-6 space-y-6">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-black text-stone-800 tracking-tighter italic">
                                    <i className="fas fa-scroll mr-2"></i>秘籍录入
                                </h1>
                            </div>

                            <div className="bg-white p-4 rounded-2xl shadow-xl border-b-4 border-stone-300">
                                <label className="text-[10px] font-bold text-stone-400 uppercase tracking-widest block mb-2">输入法术口诀</label>
                                <textarea 
                                    className="w-full h-40 p-3 bg-stone-50 border-none rounded-xl text-sm focus:ring-2 focus:ring-amber-500 outline-none"
                                    placeholder="在此粘贴菜谱原文..."
                                    value={rawText}
                                    onChange={(e) => setRawText(e.target.value)}
                                />
                                <button 
                                    onClick={parseSecret}
                                    className="w-full mt-4 bg-stone-800 text-white py-4 rounded-xl font-bold active:scale-95 transition-all"
                                >
                                    参 悟 秘 籍
                                </button>
                            </div>

                            {menuData.title && (
                                <div className="text-center animate-bounce mt-10">
                                    <button 
                                        onClick={() => setIsCooking(true)}
                                        className="bg-rose-500 text-white px-10 py-5 rounded-full font-black text-xl shadow-2xl"
                                    >
                                        <i className="fas fa-play-circle mr-2"></i>开始修炼
                                    </button>
                                </div>
                            )}
                        </div>
                    ) : (
                        /* 修炼模式：沉浸黑金风格 */
                        <div className="fixed inset-0 bg-stone-950 text-stone-200 flex flex-col z-50">
                            {/* 顶栏 */}
                            <div className="p-4 border-b border-stone-800 flex justify-between items-center bg-stone-900">
                                <button onClick={() => setIsCooking(false)}><i className="fas fa-times text-xl"></i></button>
                                <span className="text-[10px] font-bold tracking-[0.3em] text-stone-500">
                                    第 {currentStepIndex + 1} 步
                                </span>
                                <i className="fas fa-ellipsis-h text-stone-500"></i>
                            </div>

                            {/* 内容展示 */}
                            <div className="flex-1 flex flex-col items-center justify-center p-8 text-center">
                                <div className="mb-10">
                                    <Flame level={2} />
                                </div>
                                <h2 className="text-4xl font-black mb-6 text-white leading-tight">
                                    {menuData.sections[0].items[currentStepIndex]?.name || '终式'}
                                </h2>
                                <p className="text-xl font-light text-stone-400 leading-relaxed italic">
                                    “{menuData.sections[0].items[currentStepIndex]?.desc || '大功告成'}”
                                </p>
                            </div>

                            {/* 底部导航 */}
                            <div className="p-6 bg-stone-900 border-t border-stone-800 flex gap-4">
                                <button 
                                    onClick={() => setCurrentStepIndex(Math.max(0, currentStepIndex - 1))}
                                    className="flex-1 py-5 rounded-2xl bg-stone-800 text-white active:scale-95"
                                >
                                    <i className="fas fa-chevron-left"></i>
                                </button>
                                <button 
                                    onClick={() => {
                                        speak(menuData.sections[0].items[currentStepIndex]?.desc);
                                        if(currentStepIndex < menuData.sections[0].items.length - 1) {
                                            setCurrentStepIndex(currentStepIndex + 1);
                                        } else {
                                            setIsCooking(false);
                                            alert('恭喜道友，厨艺大增！');
                                        }
                                    }}
                                    className="flex-[3] py-5 rounded-2xl bg-emerald-600 text-white font-black text-lg active:scale-95 shadow-lg shadow-emerald-900/20"
                                >
                                    下一式 <i className="fas fa-magic ml-2"></i>
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
